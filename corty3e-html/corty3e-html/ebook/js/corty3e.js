/* 
   This is the standard template you should add to your book JS file before 
   customizing.

   Uncomment any of the configuration options to change the default behavior (see 
   https://macmillanhighered.atlassian.net/wiki/display/MP/Player+Configuration+Options
   for descriptions of the options).

*/

/* section link map */
/* maps id reference to URL */

var section_link_map = {};

// sections
section_link_map['#corty3e-ch1-sec1-1'] = 'corty3e_ch1_2.html';
section_link_map['#corty3e-ch1-sec1-2'] = 'corty3e_ch1_3.html';
section_link_map['#corty3e-ch1-sec1-3'] = 'corty3e_ch1_4.html';
section_link_map['#corty3e-ch1-sec1-4'] = 'corty3e_ch1_5.html';
section_link_map['#corty3e-ch1-sec1-5'] = 'corty3e_ch1_6.html';
section_link_map['#corty3e-ch2-sec1-1'] = 'corty3e_ch2_2.html';
section_link_map['#corty3e-ch2-sec1-2'] = 'corty3e_ch2_3.html';
section_link_map['#corty3e-ch2-sec1-3'] = 'corty3e_ch2_4.html';
section_link_map['#corty3e-ch2-sec1-4'] = 'corty3e_ch2_5.html';
section_link_map['#corty3e-ch2-sec1-5'] = 'corty3e_ch2_6.html';
section_link_map['#corty3e-ch3-sec1-1'] = 'corty3e_ch3_2.html';
section_link_map['#corty3e-ch3-sec1-2'] = 'corty3e_ch3_3.html';
section_link_map['#corty3e-ch3-sec1-3'] = 'corty3e_ch3_4.html';
section_link_map['#corty3e-ch3-sec1-4'] = 'corty3e_ch3_5.html';
section_link_map['#corty3e-ch3-sec1-5'] = 'corty3e_ch3_6.html';
section_link_map['#corty3e-ch4-sec1-1'] = 'corty3e_ch4_2.html';
section_link_map['#corty3e-ch4-sec1-2'] = 'corty3e_ch4_3.html';
section_link_map['#corty3e-ch4-sec1-3'] = 'corty3e_ch4_4.html';
section_link_map['#corty3e-ch4-sec1-4'] = 'corty3e_ch4_5.html';
section_link_map['#corty3e-ch4-sec1-5'] = 'corty3e_ch4_6.html';
section_link_map['#corty3e-ch5-sec1-1'] = 'corty3e_ch5_2.html';
section_link_map['#corty3e-ch5-sec1-2'] = 'corty3e_ch5_3.html';
section_link_map['#corty3e-ch5-sec1-3'] = 'corty3e_ch5_4.html';
section_link_map['#corty3e-ch5-sec1-4'] = 'corty3e_ch5_5.html';
section_link_map['#corty3e-ch5-sec1-5'] = 'corty3e_ch5_6.html';
section_link_map['#corty3e-ch6-sec1-1'] = 'corty3e_ch6_2.html';
section_link_map['#corty3e-ch6-sec1-2'] = 'corty3e_ch6_3.html';
section_link_map['#corty3e-ch6-sec1-3'] = 'corty3e_ch6_4.html';
section_link_map['#corty3e-ch6-sec1-4'] = 'corty3e_ch6_5.html';
section_link_map['#corty3e-ch6-sec1-5'] = 'corty3e_ch6_6.html';
section_link_map['#corty3e-ch7-sec1-1'] = 'corty3e_ch7_2.html';
section_link_map['#corty3e-ch7-sec1-2'] = 'corty3e_ch7_3.html';
section_link_map['#corty3e-ch7-sec1-3'] = 'corty3e_ch7_4.html';
section_link_map['#corty3e-ch7-sec1-4'] = 'corty3e_ch7_5.html';
section_link_map['#corty3e-ch7-sec1-5'] = 'corty3e_ch7_6.html';
section_link_map['#corty3e-ch8-sec1-1'] = 'corty3e_ch8_2.html';
section_link_map['#corty3e-ch8-sec1-2'] = 'corty3e_ch8_3.html';
section_link_map['#corty3e-ch8-sec1-3'] = 'corty3e_ch8_4.html';
section_link_map['#corty3e-ch8-sec1-4'] = 'corty3e_ch8_5.html';
section_link_map['#corty3e-ch8-sec1-5'] = 'corty3e_ch8_6.html';
section_link_map['#corty3e-ch9-sec1-1'] = 'corty3e_ch9_2.html';
section_link_map['#corty3e-ch9-sec1-2'] = 'corty3e_ch9_3.html';
section_link_map['#corty3e-ch9-sec1-3'] = 'corty3e_ch9_4.html';
section_link_map['#corty3e-ch9-sec1-4'] = 'corty3e_ch9_5.html';
section_link_map['#corty3e-ch9-sec1-5'] = 'corty3e_ch9_6.html';
section_link_map['#corty3e-ch10-sec1-1'] = 'corty3e_ch10_2.html';
section_link_map['#corty3e-ch10-sec1-2'] = 'corty3e_ch10_3.html';
section_link_map['#corty3e-ch10-sec1-3'] = 'corty3e_ch10_4.html';
section_link_map['#corty3e-ch10-sec1-4'] = 'corty3e_ch10_5.html';
section_link_map['#corty3e-ch10-sec1-5'] = 'corty3e_ch10_6.html';
section_link_map['#corty3e-ch11-sec1-1'] = 'corty3e_ch11_2.html';
section_link_map['#corty3e-ch11-sec1-2'] = 'corty3e_ch11_3.html';
section_link_map['#corty3e-ch11-sec1-3'] = 'corty3e_ch11_4.html';
section_link_map['#corty3e-ch11-sec1-4'] = 'corty3e_ch11_5.html';
section_link_map['#corty3e-ch11-sec1-5'] = 'corty3e_ch11_6.html';
section_link_map['#corty3e-ch12-sec1-1'] = 'corty3e_ch12_2.html';
section_link_map['#corty3e-ch12-sec1-2'] = 'corty3e_ch12_3.html';
section_link_map['#corty3e-ch12-sec1-3'] = 'corty3e_ch12_4.html';
section_link_map['#corty3e-ch12-sec1-4'] = 'corty3e_ch12_5.html';
section_link_map['#corty3e-ch12-sec1-5'] = 'corty3e_ch12_6.html';
section_link_map['#corty3e-ch13-sec1-1'] = 'corty3e_ch13_2.html';
section_link_map['#corty3e-ch13-sec1-2'] = 'corty3e_ch13_3.html';
section_link_map['#corty3e-ch13-sec1-3'] = 'corty3e_ch13_4.html';
section_link_map['#corty3e-ch13-sec1-4'] = 'corty3e_ch13_5.html';
section_link_map['#corty3e-ch13-sec1-5'] = 'corty3e_ch13_6.html';
section_link_map['#corty3e-ch14-sec1-1'] = 'corty3e_ch14_2.html';
section_link_map['#corty3e-ch14-sec1-2'] = 'corty3e_ch14_3.html';
section_link_map['#corty3e-ch14-sec1-3'] = 'corty3e_ch14_4.html';
section_link_map['#corty3e-ch14-sec1-4'] = 'corty3e_ch14_5.html';
section_link_map['#corty3e-ch14-sec1-5'] = 'corty3e_ch14_6.html';
section_link_map['#corty3e-ch15-sec1-1'] = 'corty3e_ch15_2.html';
section_link_map['#corty3e-ch15-sec1-2'] = 'corty3e_ch15_3.html';
section_link_map['#corty3e-ch15-sec1-3'] = 'corty3e_ch15_4.html';
section_link_map['#corty3e-ch15-sec1-4'] = 'corty3e_ch15_5.html';
section_link_map['#corty3e-ch15-sec1-5'] = 'corty3e_ch15_6.html';
section_link_map['#corty3e-ch16-sec1-1'] = 'corty3e_ch16_2.html';
section_link_map['#corty3e-ch16-sec1-2'] = 'corty3e_ch16_3.html';
section_link_map['#corty3e-ch16-sec1-3'] = 'corty3e_ch16_4.html';
section_link_map['#corty3e-ch16-sec1-4'] = 'corty3e_ch16_5.html';
section_link_map['#corty3e-ch16-sec1-5'] = 'corty3e_ch16_6.html';


// chapters
section_link_map['corty3e-ch01.xml'] = 'corty3e_ch1_1.html';
section_link_map['corty3e-ch02.xml'] = 'corty3e_ch2_1.html';
section_link_map['corty3e-ch03.xml'] = 'corty3e_ch3_1.html';
section_link_map['corty3e-ch04.xml'] = 'corty3e_ch4_1.html';
section_link_map['corty3e-ch05.xml'] = 'corty3e_ch5_1.html';
section_link_map['corty3e-ch06.xml'] = 'corty3e_ch6_1.html';
section_link_map['corty3e-ch07.xml'] = 'corty3e_ch7_1.html';
section_link_map['corty3e-ch08.xml'] = 'corty3e_ch8_1.html';
section_link_map['corty3e-ch09.xml'] = 'corty3e_ch9_1.html';
section_link_map['corty3e-ch10.xml'] = 'corty3e_ch10_1.html';
section_link_map['corty3e-ch11.xml'] = 'corty3e_ch11_1.html';
section_link_map['corty3e-ch12.xml'] = 'corty3e_ch12_1.html';
section_link_map['corty3e-ch13.xml'] = 'corty3e_ch13_1.html';
section_link_map['corty3e-ch14.xml'] = 'corty3e_ch14_1.html';
section_link_map['corty3e-ch15.xml'] = 'corty3e_ch15_1.html';
section_link_map['corty3e-ch16.xml'] = 'corty3e_ch16_1.html';
section_link_map['corty3e-appa.xml'] = 'corty3e_app1_1.html';
section_link_map['corty3e-appb.xml'] = 'corty3e_app2_1.html';
section_link_map['corty3e-appc.xml'] = 'corty3e_app3_1.html';
section_link_map['corty3e-appd.xml'] = 'corty3e_app4_1.html';


/**************************************
  Set this to the DF book ID (Subtype)
 **************************************/
xBookUtils.bookID = "corty3e";

/* 
   You only need to set the disciplines if you are using the HTML Quiz 
   question delivery method, which only BSM ebooks and HTML Quizzes are at this 
   time (in other words, if this is a FW ebook then you don't need to do a thing).  
   Change the zeros to the discipline number for each tier on PX.

   Discipline numbers:

   History: 6696 (all tiers)
   Composition: 6698 (all tiers)
   Communication: 6700 (all tiers)
   College Success: 6704 (all tiers)

   If you do not know the discipline number for your book then ask your MP.
*/
xBookUtils.discipline = {
    dev: 0,
    qa: 0,
    pr: 0,
    www: 0
}

var Player_subtype = Player_manuscript_type.extend({
    
    //cfg_removeRawHtmlDivs: "on",

    cfg_showAnswer: "on",
    //cfg_showAnswerAutoWrapThis: "off",
    
    // to move h3 out of b0x_inner
    //cfg_Box_moveTitle: "all",
    //cfg_Box_moveTitleExclude: "",

    //cfg_Figures_targetDefault: "_blank",
    cfg_Figures_resizeDivWidth: "on",

    cfg_Figures_autoHtml: "on",
    cfg_LH_autoHtml: "on",

    cfg_LH_externalTargetDefault: "_pop",
    cfg_LH_internalTargetDefault: "_pop",
    cfg_LH_ebookTargetDefault: "_pop",
    //cfg_LH_imageTargetDefault: "_blank",

    cfg_LH_useOpenContent: "on",
    cfg_LH_useLinksFile: "on",
    
    cfg_Glossary_hoverTerms: "on",
    cfg_Glossary_useStickyDiv: "on",
    //cfg_Glossary_hoverTermsNoClick: "",

    initialize_sections: function() {
	
	// Do not delete this
	this._super();
	
        // Anything that needs to be done before the page displays 
	// should be done here.
	
	var bookid = "corty3e";
	var matches;

        // give last section a blue background -- add class to body tag
        $('[data-block_type="cr-h"]').parents('body').addClass('blue_bg');
    
        /* restructure questions one-off */
        $('#digfir_section_7 [data-type="question"] [data-block_type="cr-nl"] > p').each(function(i, el) {
            var new_html = ++i + '. ' + $(this).html();
            $(this).html(new_html);
        });

        // Run section-link_map above, providing section links
        //Section references linked to sections
        $('a[href]').each(function(){
            var old_href = $(this).attr('href');
            if(section_link_map.hasOwnProperty(old_href)){
                $(this).attr('href', section_link_map[old_href]);
            }
        });

        /* hack to get figure ids */
        $('div[data-figure-id]').each(function (index, element) {
            var id = $(this).attr('data-figure-id');
            $(this).attr('id', id);
        });

    }, // end initialize_sections
    

    /* 
       You will most likely not make any changes to the initialize
       method unless you know exactly what you are doing :-)
    */
    initialize: function(id) {
	
	// Do not delete this
	this._super(id);
	
	this.xrefs = new XRefs_manuscript_subtype();
    // note that terms.js is turned off for this book in the following arguments
	//this.glossary = new Glossary_manuscript_subtype({terms: false});
	this.glossary = new Glossary_manuscript_subtype();
    this.figures = new Figures_manuscript_subtype();	
	
    }, // end initialize
    
    initialize2: function() {
	
	// Do not delete this
        this._super();

	var link_handler = new LinkHandler();

	// Anything that can be done after the page displays 
	// should be done here.

        //$(window).load(function() {        
        //   $('#supp_win > [data-type="figure"]').each(function() {
        //     // $(this).removeAttr('data-caption-compass');
        //     var imgwidth = $(this).find('img').width();
        //     $(this).find('[data-type="figure_text"]').width(imgwidth);
        //   });
        //});
        
        /////////////////////////////////////////////////
        // Figures
        
        // opening cover images should not pop -- just remove data-type="figure"
        $('[data-block_type="intro"] [data-figure-id$="fig-001"]').removeAttr('data-type');
        
        // remove superfluous colon character from figure titles
        $('[data-type="figure_text"] [data-type="number"]').each(function() {
            var txt = $(this).text();
            txt = txt.replace(/(Figure \d+\.\d+):/i, "$1");
            $(this).text(txt);
        });
        
        // make special feature section titles wider than others
        var feat_sec = $('#digfir_section_0 > h2.section-title');
        var dbt = feat_sec.next().attr('data-block_type');
        if (dbt == "bx1-h") {
            feat_sec.css('width', '845px');
        } else if (dbt == "bx2-h") {
            feat_sec.css('width', '805px');
        } else if (dbt == "bx3-t") {
            feat_sec.css('width', '845px');
        }
        
        ///////////////////////////////////////////////////
        // make sure link tagets are _pop, not _blank
        $('[data-type="lh-link"]').attr('target', '_pop').removeAttr('data-xrefs-target');
        
        ///////////////////////////////////////////////////
        // suplemental window code
        ///////////////////////////////////////////////////
        
        // resolve inline table and figure links to pop the supplemental window
        
        $('a[data-type="lh-link"]:contains(Table)').each(function(){
            var reftext = $(this).text();
            var chnum = reftext.replace(/Table (\d+)\.\d+/, '$1');
            if (chnum.length < 3) {
                var chnum_orig = chnum;
                if (chnum.length < 2) { chnum = '0' + chnum;}
                var tblnum = reftext.replace(/Table \d+\.(\d+)/, '$1');
                if (tblnum.length < 2) { tblnum = '0' + tblnum;}
                var suppwin = 'asset/ch' + chnum_orig + '/corty3e_table' + chnum + '_' + tblnum + '.html';
                $(this).attr('href', suppwin);
            }
        });
        
        $('a[data-type="lh-link"]:contains(Figure )').each(function(){
            var reftext = $(this).text();
            var chnum = reftext.replace(/Figure (\d+)\.\d+/, '$1');
            var chnum_orig = chnum;
            if (chnum.length < 2) { chnum = '0' + chnum;}
            var fignum = reftext.replace(/Figure \d+\.(\d+)/, '$1');
            if (fignum.length < 2) { fignum = '0' + fignum;}
            var suppwin = 'asset/ch' + chnum_orig + '/corty3e_fig' + chnum + '_' + fignum + '.html';
            $(this).attr('href', suppwin);
        });

        // remove event handlers from supplemental window images
        // this prevents clicks from popping up anything further
        $('#supp_win img').unbind();
        
        // also remove event handlers from images used for equations.
        // (also change cursor from pointer in CSS)
        $('img[src*="corty3e_eqn"]').unbind();
        
        // Front Matter

        var email_link = $(" #corty3e-fm1-p363 a");
        // leave for formatting purposes
        // email_link.removeAttr("data-type", "");
        email_link.removeAttr("target", "");

        // fix linkage oddities
        var href = $('[href="asset/ch5/corty3e_fig05_19.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch5/corty3e_fig05_19a.html');
        }
        href = $('[href="asset/ch6/corty3e_fig06_11.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch6/corty3e_fig06_11a_c.html');
        }
        href = $('[href="asset/ch6/corty3e_fig06_08.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch6/corty3e_fig06_08a_b.html');
        }
        href = $('[href="asset/ch6/corty3e_fig06_09.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch6/corty3e_fig06_09a_b.html');
        }
        href = $('[href="asset/ch6/corty3e_fig06_10.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch6/corty3e_fig06_10a_c.html');
        }
        href = $('[href="asset/ch6/corty3e_fig06_11.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch6/corty3e_fig06_11a_c.html');
        }
        href = $('[href="asset/ch10/corty3e_fig10_03.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch10/corty3e_fig10_03a_b.html');
        }
        href = $('[href="asset/ch15/corty3e_fig15_06.html"]');
        if (href.length > 0) {
            href.attr('href', 'asset/ch15/corty3e_fig15_06a_b.html');
        }
        // remove path in supp_win caption
        href = $('#supp_win [href="asset/ch14/corty3e_fig14_04.html"]');
        if (href.length > 0) {
            href.attr('href', 'corty3e_fig14_04.html');
        }

    } // end initialize2
    
}); // end Player_subtype


// Do not delete this
player = new Player_subtype();